<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cabinet Manufacturing System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card { background: white; border-radius: 16px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
    .btn { padding: 12px 24px; border-radius: 12px; font-weight: 600; transition: all 0.3s ease; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn-primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .btn-green { background: linear-gradient(135deg, #10b981, #047857); color: white; }
    .btn-red { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
    .btn-orange { background: linear-gradient(135deg, #f97316, #ea580c); color: white; }
    .btn-gray { background: linear-gradient(135deg, #6b7280, #4b5563); color: white; }
    .btn-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
    .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 50; padding: 16px; }
    .modal-content { background: white; padding: 32px; border-radius: 20px; max-width: 500px; width: 100%; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); max-height: 90vh; overflow-y: auto; }
    .hidden { display: none; }
    .input-field { border: 2px solid #e5e7eb; border-radius: 12px; padding: 12px 16px; transition: all 0.3s ease; background: white; width: 100%; }
    .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); outline: none; }
    .login-container { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-card { background: white; border-radius: 20px; padding: 40px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); max-width: 400px; width: 100%; }
    .role-badge { padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; }
    .role-admin { background: #fef3c7; color: #92400e; }
    .role-employee { background: #dbeafe; color: #1e40af; }
    .success-message { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid #22c55e; color: #15803d; padding: 16px; border-radius: 12px; margin: 16px 0; box-shadow: 0 8px 25px rgba(34, 197, 94, 0.15); }
    .alert { background: linear-gradient(135deg, #fef2f2, #fee2e2); border-left: 6px solid #ef4444; border-radius: 12px; padding: 20px; margin: 24px; box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15); }
    .stats-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 20px; margin-bottom: 32px; box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3); }
    .stat-item { text-align: center; padding: 16px; background: rgba(255, 255, 255, 0.1); border-radius: 12px; backdrop-filter: blur(10px); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">

<!-- LOGIN PAGE -->
<div id="loginPage" class="login-container">
  <div class="login-card">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">🏠 Cabinet Manufacturing</h1>
      <p class="text-gray-600">Access Control System</p>
    </div>
    
    <div class="space-y-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Employee Code:</label>
        <input type="text" id="loginCode" placeholder="Enter your employee code" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Password:</label>
        <input type="password" id="loginPassword" placeholder="Enter your password" class="input-field">
      </div>
      
      <button onclick="login()" class="btn btn-primary w-full">🔑 Login</button>
      
      <div id="loginError" class="text-red-600 text-sm text-center hidden"></div>
      
      <div class="text-center">
        <button onclick="showAdminSetup()" class="text-blue-600 hover:text-blue-800 text-sm underline">
          First time setup? Create admin account
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN SETUP PAGE -->
<div id="adminSetupPage" class="login-container hidden">
  <div class="login-card">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">👑 Admin Setup</h1>
      <p class="text-gray-600">Create the first admin account</p>
    </div>
    
    <div class="space-y-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Admin Name:</label>
        <input type="text" id="setupName" placeholder="Your full name" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Employee Code:</label>
        <input type="text" id="setupCode" placeholder="Choose a unique code" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Password:</label>
        <input type="password" id="setupPassword" placeholder="Create strong password" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password:</label>
        <input type="password" id="setupConfirm" placeholder="Confirm password" class="input-field">
      </div>
      
      <button onclick="createAdmin()" class="btn btn-green w-full">👑 Create Admin Account</button>
      
      <div id="setupError" class="text-red-600 text-sm text-center hidden"></div>
      
      <div class="text-center">
        <button onclick="showLogin()" class="text-blue-600 hover:text-blue-800 text-sm underline">
          Already have an account? Login
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="mainApp" class="max-w-7xl mx-auto p-4 lg:p-6 min-h-screen hidden">
  <div class="card overflow-hidden">
    
    <!-- Header -->
    <div class="gradient-bg text-white p-6 lg:p-8">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl lg:text-4xl font-bold flex items-center gap-3">
            🏠 Cabinet Manufacturing System
          </h1>
          <p class="text-blue-100 mt-2 text-sm lg:text-base">Professional inventory, dispatch & shipping management</p>
        </div>
        
        <!-- User Info & Logout -->
        <div class="text-right">
          <div id="userInfo" class="mb-3">
            <!-- User info will be populated here -->
          </div>
          <button onclick="logout()" class="btn btn-red text-sm">🚪 Logout</button>
        </div>
      </div>
    </div>

    <!-- Success Messages -->
    <div id="successMessage" class="success-message hidden mx-6">
      <div class="flex items-center">
        <span class="text-green-600 mr-2">✅</span>
        Operation completed successfully!
      </div>
    </div>

    <!-- Permission Denied Alert -->
    <div id="permissionAlert" class="alert hidden">
      <div class="flex items-center">
        <span class="text-red-500 mr-3 text-2xl">🚫</span>
        <div>
          <h3 class="text-red-800 font-bold text-lg">Access Denied!</h3>
          <p class="text-red-700 mt-1">You don't have permission to access this feature. Contact your administrator.</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="p-6">
      
      <!-- Stats Dashboard -->
      <div class="stats-card">
        <h3 class="text-xl lg:text-2xl font-bold mb-6 text-center">📊 Manufacturing Overview</h3>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="stat-item">
            <div class="text-2xl lg:text-3xl font-bold">25</div>
            <div class="text-blue-100 text-sm lg:text-base mt-2">Plywood Sheets</div>
          </div>
          <div class="stat-item">
            <div class="text-2xl lg:text-3xl font-bold">12</div>
            <div class="text-blue-100 text-sm lg:text-base mt-2">Finished Cabinets</div>
          </div>
          <div class="stat-item">
            <div class="text-2xl lg:text-3xl font-bold">3</div>
            <div class="text-blue-100 text-sm lg:text-base mt-2">Active Projects</div>
          </div>
          <div class="stat-item">
            <div class="text-2xl lg:text-3xl font-bold">8</div>
            <div class="text-blue-100 text-sm lg:text-base mt-2">Total Dispatches</div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="card p-6 text-center">
          <div class="text-4xl mb-4">📦</div>
          <h3 class="font-bold text-lg mb-2">Materials</h3>
          <p class="text-gray-600 mb-4">Manage plywood and materials</p>
          <button onclick="showPage('materials')" class="btn btn-primary w-full" id="materialsBtn">View Materials</button>
        </div>
        
        <div class="card p-6 text-center">
          <div class="text-4xl mb-4">🔨</div>
          <h3 class="font-bold text-lg mb-2">Manufacturing</h3>
          <p class="text-gray-600 mb-4">Production and assembly</p>
          <button onclick="showPage('manufacturing')" class="btn btn-green w-full" id="manufacturingBtn">Manufacturing</button>
        </div>
        
        <div class="card p-6 text-center">
          <div class="text-4xl mb-4">🚚</div>
          <h3 class="font-bold text-lg mb-2">Dispatch</h3>
          <p class="text-gray-600 mb-4">Shipping and delivery</p>
          <button onclick="showPage('dispatch')" class="btn btn-orange w-full" id="dispatchBtn">View Dispatches</button>
        </div>
        
        <div class="card p-6 text-center">
          <div class="text-4xl mb-4">⚙️</div>
          <h3 class="font-bold text-lg mb-2">Admin</h3>
          <p class="text-gray-600 mb-4">User and system management</p>
          <button onclick="showPage('admin')" class="btn btn-purple w-full" id="adminBtn">Admin Panel</button>
        </div>
      </div>

      <!-- Page Content -->
      <div id="pageContent" class="card p-6">
        <div class="text-center py-12">
          <div class="text-6xl mb-4">🏠</div>
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Welcome to Cabinet Manufacturing System</h2>
          <p class="text-gray-600 mb-6">Select an option above to get started with managing your cabinet manufacturing operations.</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
            <div class="bg-blue-50 p-4 rounded-lg">
              <h3 class="font-bold text-blue-800 mb-2">👑 Admin Features</h3>
              <ul class="text-sm text-blue-700 space-y-1">
                <li>• User management</li>
                <li>• Permission control</li>
                <li>• System configuration</li>
                <li>• Full data access</li>
              </ul>
            </div>
            
            <div class="bg-green-50 p-4 rounded-lg">
              <h3 class="font-bold text-green-800 mb-2">👷 Employee Features</h3>
              <ul class="text-sm text-green-700 space-y-1">
                <li>• View materials</li>
                <li>• Create dispatches</li>
                <li>• Monitor production</li>
                <li>• Limited access</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Create User Modal -->
<div id="userModal" class="modal hidden">
  <div class="modal-content">
    <h3 class="text-xl font-bold mb-6 text-center">👤 Create New User</h3>
    
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name:</label>
        <input type="text" id="newUserName" placeholder="Employee full name" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Employee Code:</label>
        <input type="text" id="newUserCode" placeholder="Unique employee code" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Role:</label>
        <select id="newUserRole" class="input-field">
          <option value="employee">👷 Employee</option>
          <option value="admin">👑 Admin</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Password:</label>
        <input type="password" id="newUserPassword" placeholder="Temporary password" class="input-field">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Department:</label>
        <input type="text" id="newUserDepartment" placeholder="e.g., Manufacturing, Shipping" class="input-field">
      </div>
    </div>

    <div class="flex gap-3 mt-6">
      <button onclick="createUser()" class="btn btn-green flex-1">✅ Create User</button>
      <button onclick="closeModal('userModal')" class="btn btn-gray flex-1">❌ Cancel</button>
    </div>
  </div>
</div>

<script>
// CABINET MANUFACTURING SYSTEM - CLEAN VERSION
// All functions defined immediately to prevent errors

// Global Variables
let currentUser = null;
let users = [];
let currentPage = 'home';

// Initialize sample users immediately
function initializeUsers() {
  users = [
    {
      id: 1,
      name: 'Admin User',
      employeeCode: 'ADMIN001',
      role: 'admin',
      password: btoa('admin123'),
      department: 'Administration',
      active: true,
      permissions: { all: true }
    },
    {
      id: 2,
      name: 'John Worker',
      employeeCode: 'EMP001',
      role: 'employee',
      password: btoa('worker123'),
      department: 'Manufacturing',
      active: true,
      permissions: { materials_view: true, manufacturing_view: true, dispatch_view: true }
    }
  ];
}

// Authentication Functions
function showLogin() {
  document.getElementById('loginPage').classList.remove('hidden');
  document.getElementById('adminSetupPage').classList.add('hidden');
  document.getElementById('mainApp').classList.add('hidden');
  
  // Clear form
  document.getElementById('loginCode').value = '';
  document.getElementById('loginPassword').value = '';
  hideError('loginError');
}

function showAdminSetup() {
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('adminSetupPage').classList.remove('hidden');
  document.getElementById('mainApp').classList.add('hidden');
  
  // Clear form
  document.getElementById('setupName').value = '';
  document.getElementById('setupCode').value = '';
  document.getElementById('setupPassword').value = '';
  document.getElementById('setupConfirm').value = '';
  hideError('setupError');
}

function login() {
  const code = document.getElementById('loginCode').value.trim().toUpperCase();
  const password = document.getElementById('loginPassword').value;

  if (!code || !password) {
    showError('loginError', 'Please enter both employee code and password');
    return;
  }

  const user = users.find(u => u.employeeCode === code && u.active);

  if (!user) {
    showError('loginError', 'Invalid employee code or account disabled');
    return;
  }

  try {
    const storedPassword = atob(user.password);
    
    if (password !== storedPassword) {
      showError('loginError', 'Invalid password');
      return;
    }

    currentUser = user;
    showMainApp();
  } catch (error) {
    showError('loginError', 'Login failed. Please try again.');
  }
}

function createAdmin() {
  const name = document.getElementById('setupName').value.trim();
  const code = document.getElementById('setupCode').value.trim().toUpperCase();
  const password = document.getElementById('setupPassword').value;
  const confirm = document.getElementById('setupConfirm').value;

  if (!name || !code || !password || !confirm) {
    showError('setupError', 'Please fill in all fields');
    return;
  }

  if (password !== confirm) {
    showError('setupError', 'Passwords do not match');
    return;
  }

  if (password.length < 6) {
    showError('setupError', 'Password must be at least 6 characters');
    return;
  }

  // Check if code already exists
  if (users.find(user => user.employeeCode === code)) {
    showError('setupError', 'Employee code already exists');
    return;
  }

  const adminUser = {
    id: Date.now(),
    name,
    employeeCode: code,
    role: 'admin',
    password: btoa(password),
    department: 'Administration',
    active: true,
    permissions: { all: true }
  };

  users.push(adminUser);
  showSuccess('Admin account created successfully! You can now login.');
  setTimeout(() => showLogin(), 2000);
}

function logout() {
  currentUser = null;
  showLogin();
}

// Main App Functions
function showMainApp() {
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('adminSetupPage').classList.add('hidden');
  document.getElementById('mainApp').classList.remove('hidden');
  
  updateUserInterface();
  showPage('home');
}

function updateUserInterface() {
  const userInfo = document.getElementById('userInfo');
  if (currentUser) {
    const roleClass = currentUser.role === 'admin' ? 'role-admin' : 'role-employee';
    const roleIcon = currentUser.role === 'admin' ? '👑' : '👷';
    
    userInfo.innerHTML = `
      <div class="text-sm">
        <div class="font-semibold">${currentUser.name}</div>
        <div class="flex items-center gap-2">
          <span class="role-badge ${roleClass}">${roleIcon} ${currentUser.role.toUpperCase()}</span>
          <span class="text-blue-200">Code: ${currentUser.employeeCode}</span>
        </div>
        <div class="text-blue-200 text-xs">${currentUser.department}</div>
      </div>
    `;

    updateButtonPermissions();
  }
}

function updateButtonPermissions() {
  const isAdmin = currentUser && currentUser.role === 'admin';
  
  // Admin button only for admins
  const adminBtn = document.getElementById('adminBtn');
  if (adminBtn) {
    if (isAdmin) {
      adminBtn.disabled = false;
      adminBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    } else {
      adminBtn.disabled = true;
      adminBtn.classList.add('opacity-50', 'cursor-not-allowed');
    }
  }
}

function hasPermission(permission) {
  if (!currentUser) return false;
  if (currentUser.role === 'admin') return true;
  return currentUser.permissions && (currentUser.permissions.all || currentUser.permissions[permission]);
}

function showPage(pageName) {
  currentPage = pageName;
  const content = document.getElementById('pageContent');
  
  switch(pageName) {
    case 'materials':
      if (!hasPermission('materials_view')) {
        showPermissionDenied();
        return;
      }
      content.innerHTML = `
        <div class="text-center py-8">
          <div class="text-4xl mb-4">📦</div>
          <h2 class="text-2xl font-bold mb-4">Materials Management</h2>
          <p class="text-gray-600 mb-6">Manage plywood, hardware, and other materials</p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
            <div class="bg-blue-50 p-4 rounded-lg">
              <h3 class="font-bold">Oak Plywood 3/4"</h3>
              <p class="text-2xl font-bold text-blue-600">25</p>
              <p class="text-sm text-gray-600">sheets available</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <h3 class="font-bold">MDF 3/4"</h3>
              <p class="text-2xl font-bold text-green-600">15</p>
              <p class="text-sm text-gray-600">sheets available</p>
            </div>
            <div class="bg-orange-50 p-4 rounded-lg">
              <h3 class="font-bold">Hardware Sets</h3>
              <p class="text-2xl font-bold text-orange-600">50</p>
              <p class="text-sm text-gray-600">sets available</p>
            </div>
          </div>
        </div>
      `;
      break;
      
    case 'manufacturing':
      content.innerHTML = `
        <div class="text-center py-8">
          <div class="text-4xl mb-4">🔨</div>
          <h2 class="text-2xl font-bold mb-4">Manufacturing</h2>
          <p class="text-gray-600 mb-6">Production and assembly operations</p>
          <div class="max-w-md mx-auto space-y-4">
            <div class="bg-blue-50 p-4 rounded-lg text-left">
              <h3 class="font-bold">24" Base Cabinet</h3>
              <p class="text-sm text-gray-600">Ready for manufacturing</p>
              <button class="btn btn-green mt-2">🔨 Start Production</button>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-left">
              <h3 class="font-bold">Wall Cabinet 30"</h3>
              <p class="text-sm text-gray-600">In production</p>
              <button class="btn btn-orange mt-2">📊 View Progress</button>
            </div>
          </div>
        </div>
      `;
      break;
      
    case 'dispatch':
      content.innerHTML = `
        <div class="text-center py-8">
          <div class="text-4xl mb-4">🚚</div>
          <h2 class="text-2xl font-bold mb-4">Dispatch & Shipping</h2>
          <p class="text-gray-600 mb-6">Manage deliveries and shipments</p>
          <div class="max-w-md mx-auto space-y-4">
            <div class="bg-yellow-50 p-4 rounded-lg text-left">
              <h3 class="font-bold">Dispatch #001</h3>
              <p class="text-sm text-gray-600">Pending delivery - 3 cabinets</p>
              <p class="text-xs text-gray-500">Customer: ABC Construction</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-left">
              <h3 class="font-bold">Dispatch #002</h3>
              <p class="text-sm text-gray-600">Delivered - 5 cabinets</p>
              <p class="text-xs text-gray-500">Customer: XYZ Homes</p>
            </div>
          </div>
        </div>
      `;
      break;
      
    case 'admin':
      if (!hasPermission('admin')) {
        showPermissionDenied();
        return;
      }
      content.innerHTML = `
        <div class="py-8">
          <div class="text-center mb-8">
            <div class="text-4xl mb-4">👑</div>
            <h2 class="text-2xl font-bold mb-4">Admin Panel</h2>
            <p class="text-gray-600">System administration and user management</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
            <div class="card p-6">
              <h3 class="text-lg font-bold mb-4">👥 User Management</h3>
              <div class="space-y-2 mb-4">
                ${users.map(user => `
                  <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <div>
                      <span class="font-medium">${user.name}</span>
                      <span class="text-sm text-gray-500">(${user.employeeCode})</span>
                    </div>
                    <span class="role-badge ${user.role === 'admin' ? 'role-admin' : 'role-employee'}">${user.role}</span>
                  </div>
                `).join('')}
              </div>
              <button onclick="showModal('userModal')" class="btn btn-primary w-full">➕ Add User</button>
            </div>
            
            <div class="card p-6">
              <h3 class="text-lg font-bold mb-4">📊 System Stats</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span>Total Users:</span>
                  <span class="font-bold">${users.length}</span>
                </div>
                <div class="flex justify-between">
                  <span>Active Projects:</span>
                  <span class="font-bold">3</span>
                </div>
                <div class="flex justify-between">
                  <span>Pending Dispatches:</span>
                  <span class="font-bold">1</span>
                </div>
                <div class="flex justify-between">
                  <span>System Status:</span>
                  <span class="text-green-600 font-bold">✅ Online</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      break;
      
    default:
      // Home page content is already in HTML
      break;
  }
}

function showPermissionDenied() {
  document.getElementById('permissionAlert').classList.remove('hidden');
  setTimeout(() => {
    document.getElementById('permissionAlert').classList.add('hidden');
  }, 5000);
}

// Modal Functions
function showModal(modalId) {
  document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.add('hidden');
}

function createUser() {
  const name = document.getElementById('newUserName').value.trim();
  const code = document.getElementById('newUserCode').value.trim().toUpperCase();
  const role = document.getElementById('newUserRole').value;
  const password = document.getElementById('newUserPassword').value;
  const department = document.getElementById('newUserDepartment').value.trim();

  if (!name || !code || !password || !department) {
    alert('❌ Please fill in all fields');
    return;
  }

  if (users.find(user => user.employeeCode === code)) {
    alert('❌ Employee code already exists');
    return;
  }

  const newUser = {
    id: Date.now(),
    name,
    employeeCode: code,
    role,
    password: btoa(password),
    department,
    active: true,
    permissions: role === 'admin' ? { all: true } : { materials_view: true, manufacturing_view: true, dispatch_view: true }
  };

  users.push(newUser);
  closeModal('userModal');
  showSuccess(`User "${name}" created successfully! Employee code: ${code}`);
  
  // Refresh admin page if currently viewing it
  if (currentPage === 'admin') {
    showPage('admin');
  }
  
  // Clear form
  document.getElementById('newUserName').value = '';
  document.getElementById('newUserCode').value = '';
  document.getElementById('newUserPassword').value = '';
  document.getElementById('newUserDepartment').value = '';
}

// Utility Functions
function showError(elementId, message) {
  const element = document.getElementById(elementId);
  element.textContent = message;
  element.classList.remove('hidden');
}

function hideError(elementId) {
  document.getElementById(elementId).classList.add('hidden');
}

function showSuccess(message) {
  const element = document.getElementById('successMessage');
  element.innerHTML = `
    <div class="flex items-center">
      <span class="text-green-600 mr-2">✅</span>
      ${message}
    </div>
  `;
  element.classList.remove('hidden');
  setTimeout(() => element.classList.add('hidden'), 3000);
}

// Demo Mode Function
function enableDemoMode() {
  currentUser = {
    id: 999,
    name: 'Demo Admin',
    employeeCode: 'DEMO001',
    role: 'admin',
    department: 'Demo',
    active: true,
    permissions: { all: true }
  };
  showMainApp();
  showSuccess('🎮 Demo mode enabled! You are now logged in as Demo Admin.');
}

// Emergency Login Function
function emergencyLogin() {
  currentUser = {
    id: 888,
    name: 'Emergency Admin',
    employeeCode: 'EMERGENCY',
    role: 'admin',
    department: 'Emergency',
    active: true,
    permissions: { all: true }
  };
  showMainApp();
  showSuccess('🆘 Emergency login successful! You are now logged in as Emergency Admin.');
}

// Make functions globally available
window.showLogin = showLogin;
window.showAdminSetup = showAdminSetup;
window.login = login;
window.createAdmin = createAdmin;
window.logout = logout;
window.showPage = showPage;
window.showModal = showModal;
window.closeModal = closeModal;
window.createUser = createUser;
window.enableDemoMode = enableDemoMode;
window.emergencyLogin = emergencyLogin;

// Initialize the system
console.log('🚀 Cabinet Manufacturing System - Clean Version Starting...');

// Initialize users immediately
initializeUsers();

// Show login page when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
  console.log('📄 DOM loaded, showing login page...');
  showLogin();
});

// Immediate fallback
setTimeout(() => {
  if (document.getElementById('loginPage').classList.contains('hidden') && 
      document.getElementById('adminSetupPage').classList.contains('hidden') && 
      document.getElementById('mainApp').classList.contains('hidden')) {
    console.log('🔄 Fallback: Showing login page...');
    showLogin();
  }
}, 100);

console.log('✅ System initialized successfully!');
console.log('🔑 Demo credentials: ADMIN001/admin123 or EMP001/worker123');
console.log('🎮 Emergency functions: enableDemoMode() or emergencyLogin()');

</script>

</body>
</html>

